.PHONY: install lb delete clean status all help

help: ## Show this help message
	@echo "Available targets:"
	@awk 'BEGIN {FS = ":.*##"} /^[a-zA-Z_-]+:.*##/ { printf "  %-15s %s\n", $$1, $$2 }' $(MAKEFILE_LIST)

install: ## Create kind cluster with configuration
	@echo "ğŸš€ Setting up kind cluster..."
	@if kind get clusters | grep -q "^aws101$$"; then \
		echo "âš ï¸  Cluster 'aws101' already exists"; \
	else \
		kind create cluster --name aws101 --config kind-cluster.yml; \
		echo "âœ… Cluster created successfully"; \
	fi

lb: ## Install MetalLB load balancer
	@echo "ğŸ”§ Setting up MetalLB..."
	@./metallb/metallb.sh

delete: ## Delete kind cluster
	@echo "ğŸ—‘ï¸  Removing kind cluster..."
	@if kind get clusters | grep -q "^aws101$$"; then \
		kind delete cluster --name aws101; \
		echo "âœ… Cluster deleted successfully"; \
	else \
		echo "âš ï¸  Cluster 'aws101' does not exist"; \
	fi

clean: delete ## Alias for delete

status: ## Show cluster status
	@echo "ğŸ“Š Cluster status:"
	@if kind get clusters | grep -q "^aws101$$"; then \
		echo "âœ… Cluster 'aws101' is running"; \
		kubectl cluster-info --context kind-aws101 2>/dev/null || echo "âŒ kubectl context not available"; \
	else \
		echo "âŒ Cluster 'aws101' not found"; \
	fi

all: install lb ## Install cluster and MetalLB
